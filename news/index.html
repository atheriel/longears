<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Changelog • longears</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Changelog" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-news">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">longears</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/atheriel/longears/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
      <h1 data-toc-skip>Changelog <small></small></h1>
      <small>Source: <a href='https://github.com/atheriel/longears/blob/master/NEWS.md'><code>NEWS.md</code></a></small>
    </div>

    <div id="longears-0249000" class="section level1">
<h1 class="page-header" data-toc-text="0.2.4.9000">
<a href="#longears-0249000" class="anchor"></a>longears 0.2.4.9000</h1>
<ul>
<li><p>The package now builds and installs correctly on Windows with a stock <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a> toolchain.</p></li>
<li><p>If the <code>librabbitmq</code> system dependency is not detected during installation, the <code>configure</code> script will attempt to download and build it directly, provided you have a working <code>cmake</code> available.</p></li>
<li>
<p>Consumers created with <code><a href="../reference/amqp_consume.html">amqp_consume()</a></code> will now acknowledge messages only <em>after</em> the callback has run. Moreover, when a callback fails the message in question will be nacked instead. The new <code>requeue_on_error</code> parameter controls whether messages should be redelivered when callbacks error; by default it is <code>FALSE</code>, in line with current behaviour. For complete control over when and how messages are nacked, one can use the new <code><a href="../reference/amqp_consume.html">amqp_nack()</a></code> function, which works like <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code> inside a message handler. The following is an example of complex acknowledgement behaviour for a consumer, which might be used in combination with a <a href="https://www.rabbitmq.com/dlx.html">dead letter exchange</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">consumer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amqp_consume.html">amqp_consume</a></span><span class="op">(</span><span class="va">conn</span>, <span class="va">queue</span>, <span class="kw">function</span><span class="op">(</span><span class="va">msg</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">msg</span><span class="op">$</span><span class="va">redelivered</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"can't handle this either, dead-letter it"</span><span class="op">)</span>
    <span class="fu"><a href="../reference/amqp_consume.html">amqp_nack</a></span><span class="op">(</span>requeue <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"can't handle this, maybe someone else can"</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>, requeue_on_error <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</li>
<li><p>Consumers can now control the number of prefetched messages, though the default remains 50. The most likely reason to do so is to implement true round-robin dispatch by setting it to exactly 1. This is useful in scenarios where parallel workers fetch messages from the same queue and you want to guarantee that as many workers as possible are busy, even if there are less than 50 queued messages. (<a href='https://github.com/atheriel/longears/issues/12'>#12</a> by <a href='https://github.com/SyncM1972'>@SyncM1972</a>, Closes <a href='https://github.com/atheriel/longears/issues/2'>#2</a>)</p></li>
<li><p><code>ampq_connect()</code> now takes a <code>name</code> parameter that allows users to set a connection name, which will appear in the RabbitMQ management plugin web interface and other supported UIs.</p></li>
<li><p>The <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> method for a connection will now print out all server and client properties for a connection when passed <code>full = TRUE</code>.</p></li>
<li><p>Fix potential memory corruption when passing raw vectors as properties or headers.</p></li>
</ul>
</div>
    <div id="longears-024-2020-08-27" class="section level1">
<h1 class="page-header" data-toc-text="0.2.4">
<a href="#longears-024-2020-08-27" class="anchor"></a>longears 0.2.4 (2020-08-27)</h1>
<ul>
<li><p>Fixes handling of connection failures in <code><a href="../reference/amqp_consume.html">amqp_listen()</a></code>. Previously if you got booted off the cluster during the acknowledgement phase the connection would not be closed properly and only a warning would be triggered. Now that warning is a hard error, as it should be.</p></li>
<li><p>Fixes setting of prefetch counts on consumers; previously they were nonfunctional due to a misunderstanding of the AMQP spec and RabbitMQ’s interpretation of it. This should improve performance in some cases.</p></li>
</ul>
</div>
    <div id="longears-023-2020-07-14" class="section level1">
<h1 class="page-header" data-toc-text="0.2.3">
<a href="#longears-023-2020-07-14" class="anchor"></a>longears 0.2.3 (2020-07-14)</h1>
<ul>
<li><p><code><a href="../reference/amqp_consume.html">amqp_listen()</a></code> will now respect the timeout value even when processing many messages. To reliably consume “endlessly”, use a <code>while(TRUE)</code> loop.</p></li>
<li><p>Connections now set common client properties, which are visible in the RabbitMQ management plugin web interface.</p></li>
<li><p>Fixes usage of <code>librabbitmq</code> connection objects during disconnection events; it turns out that re-using these handles can sometimes cause issues when attempting to reconnect to a server.</p></li>
<li><p>Fix compilation issues due to a missing header on pre-3.4 versions of R.</p></li>
</ul>
</div>
    <div id="longears-022-2020-03-20" class="section level1">
<h1 class="page-header" data-toc-text="0.2.2">
<a href="#longears-022-2020-03-20" class="anchor"></a>longears 0.2.2 (2020-03-20)</h1>
<ul>
<li><p><code><a href="../reference/amqp_publish.html">amqp_publish()</a></code> will now accept raw vectors for the message body in addition to strings. (<a href='https://github.com/atheriel/longears/issues/4'>#4</a> by <a href='https://github.com/dselivanov'>@dselivanov</a>)</p></li>
<li><p>Connections now set a heartbeat of 60 seconds. This should hopefully eliminate bugs where R would hang when trying to send messages to a closed socket (especially inside finalizers).</p></li>
<li><p>Adds support for consumer cancel notifications, under which the RabbitMQ broker will send an appropriate message when e.g. a consumer’s queue is deleted on the server side. The background thread will throw a warning, similar to how connection errors are currently surfaced. Prior to this, consumers would simply fall silent without a warning of any kind.</p></li>
<li><p>Handling of closed connections on background threads has been improved.</p></li>
</ul>
</div>
    <div id="longears-021-2019-08-28" class="section level1">
<h1 class="page-header" data-toc-text="0.2.1">
<a href="#longears-021-2019-08-28" class="anchor"></a>longears 0.2.1 (2019-08-28)</h1>
<ul>
<li><p>First public release.</p></li>
<li><p>Includes various improvements to top-level documentation.</p></li>
</ul>
</div>
    <div id="longears-020-2019-07-19" class="section level1">
<h1 class="page-header" data-toc-text="0.2.0">
<a href="#longears-020-2019-07-19" class="anchor"></a>longears 0.2.0 (2019-07-19)</h1>
<ul>
<li><p>Additional arguments can now be passed to exchange and queue declarations, consumers, and bindings, allowing users to employ most of RabbitMQ’s extensions to the AMQP protocol.</p></li>
<li><p>Additional arguments passed to <code><a href="../reference/amqp_properties.html">amqp_properties()</a></code> are now interpreted as custom message headers, with R types mapped to an appropriate AMQP field automatically.</p></li>
<li><p>Exchange-to-exchange bindings are now available through <code><a href="../reference/amqp_bindings.html">amqp_bind_exchange()</a></code> and <code><a href="../reference/amqp_bindings.html">amqp_unbind_exchange()</a></code>.</p></li>
<li><p>Temporary queues now default to <code>exclusive = FALSE</code>. This is a much more sensible choice, but a breaking change.</p></li>
<li><p>The background thread now checks messages at much higher frequency: 100 Hz instead of 1 Hz. This means that <code>consume_later()</code> is no longer limited to ingesting 1 message per second – it can now handle as many as 100.</p></li>
</ul>
</div>
    <div id="longears-013-2019-07-15" class="section level1">
<h1 class="page-header" data-toc-text="0.1.3">
<a href="#longears-013-2019-07-15" class="anchor"></a>longears 0.1.3 (2019-07-15)</h1>
<ul>
<li>Fixes a C-level namespace collision with <code>connect(2)</code> that could result in the wrong function being used by the linker.</li>
</ul>
</div>
    <div id="longears-012-2019-07-10" class="section level1">
<h1 class="page-header" data-toc-text="0.1.2">
<a href="#longears-012-2019-07-10" class="anchor"></a>longears 0.1.2 (2019-07-10)</h1>
<ul>
<li><p>Connection objects will no longer attempt to automatically reconnect. Instead, they will surface an error for the user. This is because “automatic” reconnection has turned out to be a bit dishonest: connections have state – exclusive or auto-deleting queues and exchanges, plus consumers – that will be lost during disconnections. Thus, the user must be informed about these events so that they can properly restore the expected state.</p></li>
<li><p>Internal handling of server/socket issues has dramatically improved. These errors will now be identified earlier and reported in a much less cryptic manner. Users will also be warned about lost consumers, either during reconnection for the foreground consumers or via a <strong>later</strong> callback for background consumers.</p></li>
<li><p>Consumers will now set a prefetch count of 50 automatically and attempt to acknowledge all messages even if the callback fails (unless they are in <code>no_ack</code> mode).</p></li>
</ul>
</div>
    <div id="longears-011-2019-06-20" class="section level1">
<h1 class="page-header" data-toc-text="0.1.1">
<a href="#longears-011-2019-06-20" class="anchor"></a>longears 0.1.1 (2019-06-20)</h1>
<ul>
<li><p>Tests requiring a local RMQ server will now be skipped unless one is detected.</p></li>
<li><p>Fixes an issue where <code><a href="../reference/amqp_properties.html">amqp_properties()</a></code> would not handle missing names correctly.</p></li>
<li><p>Fixes an issue where connection errors could sometimes encounter uninitialized memory.</p></li>
</ul>
</div>
    <div id="longears-010-2019-06-06" class="section level1">
<h1 class="page-header" data-toc-text="0.1.0">
<a href="#longears-010-2019-06-06" class="anchor"></a>longears 0.1.0 (2019-06-06)</h1>
<ul>
<li><p>First alpha release.</p></li>
<li><p>Allows for connecting to RMQ servers via <code><a href="../reference/amqp_connections.html">amqp_connect()</a></code> and <code><a href="../reference/amqp_connections.html">amqp_disconnect()</a></code>. Reconnections required by protocol errors are handled automatically, and AMQP channels are managed internally by the connection objects. Most other functions require passing a valid connection object.</p></li>
<li>
<p>Implements a subset of the AMQP feature set, including:</p>
<ul>
<li>Declaring and deleting exchanges and queues via <code><a href="../reference/amqp_exchanges.html">amqp_declare_exchange()</a></code>, <code><a href="../reference/amqp_queues.html">amqp_delete_queue()</a></code>, etc.</li>
<li>Binding queues to (and unbind them from) exchanges via <code><a href="../reference/amqp_bindings.html">amqp_bind_queue()</a></code> and <code><a href="../reference/amqp_bindings.html">amqp_unbind_queue()</a></code>.</li>
<li>Publishing messages to exchanges via <code><a href="../reference/amqp_publish.html">amqp_publish()</a></code>.</li>
<li>Encoding/decoding AMQP basic properties via <code><a href="../reference/amqp_properties.html">amqp_properties()</a></code>.</li>
<li>Retrieving individual messages from queues via <code><a href="../reference/amqp_get.html">amqp_get()</a></code>. This is the “polling” interface.</li>
<li>Consuming many messages from queues using a combination of <code><a href="../reference/amqp_consume.html">amqp_consume()</a></code> and <code><a href="../reference/amqp_consume.html">amqp_listen()</a></code>. This is the “push” interface.</li>
</ul>
</li>
<li><p>Also includes an experimental <code><a href="../reference/amqp_consume_later.html">amqp_consume_later()</a></code> function for “asynchronous” message handling. Requires that the user has an event loop compatible with the <strong>later</strong> package, such as a Shiny application.</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Aaron Jacobs.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


